<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="金融业网络安全攻防大赛WriteupsMISCMysterious Picture在公司最近的一次项目中，关键数据疑似泄漏。经过某种手段已经把嫌疑锁定在嫌疑人A身上了，但是嫌疑人A的U盘中除了一张图片之外，没有发现任何相关的信息。你能帮助公司找到他泄漏数据的确凿证据吗？ 题目给了一张图片，用StegSolve打开，每个通道都过一遍，发现rgb的最低位都有异常。 打开Analyse -&amp;gt; Da">
<meta name="keywords" content="CTF">
<meta property="og:type" content="article">
<meta property="og:title" content="金融业网络安全攻防大赛Writeups">
<meta property="og:url" content="http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/index.html">
<meta property="og:site_name" content="Jack Pan">
<meta property="og:description" content="金融业网络安全攻防大赛WriteupsMISCMysterious Picture在公司最近的一次项目中，关键数据疑似泄漏。经过某种手段已经把嫌疑锁定在嫌疑人A身上了，但是嫌疑人A的U盘中除了一张图片之外，没有发现任何相关的信息。你能帮助公司找到他泄漏数据的确凿证据吗？ 题目给了一张图片，用StegSolve打开，每个通道都过一遍，发现rgb的最低位都有异常。 打开Analyse -&amp;gt; Da">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-08-28T16:16:47.360Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="金融业网络安全攻防大赛Writeups">
<meta name="twitter:description" content="金融业网络安全攻防大赛WriteupsMISCMysterious Picture在公司最近的一次项目中，关键数据疑似泄漏。经过某种手段已经把嫌疑锁定在嫌疑人A身上了，但是嫌疑人A的U盘中除了一张图片之外，没有发现任何相关的信息。你能帮助公司找到他泄漏数据的确凿证据吗？ 题目给了一张图片，用StegSolve打开，每个通道都过一遍，发现rgb的最低位都有异常。 打开Analyse -&amp;gt; Da">
    
    
        
          
              <link rel="shortcut icon" href="/favicons/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/favicons/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>金融业网络安全攻防大赛Writeups</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="Jack Pan" type="application/atom+xml" />
    
</head>

<body class="max-width mx-auto px3">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/jack0pan">项目</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2018/05/04/Construct-Binary-Tree-from-Traversal/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/&text=金融业网络安全攻防大赛Writeups"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/&title=金融业网络安全攻防大赛Writeups"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/&is_video=false&description=金融业网络安全攻防大赛Writeups"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=金融业网络安全攻防大赛Writeups&body=Check out this article: http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/&title=金融业网络安全攻防大赛Writeups"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/&title=金融业网络安全攻防大赛Writeups"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/&title=金融业网络安全攻防大赛Writeups"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/&title=金融业网络安全攻防大赛Writeups"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/&name=金融业网络安全攻防大赛Writeups&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#金融业网络安全攻防大赛Writeups"><span class="toc-number">1.</span> <span class="toc-text">金融业网络安全攻防大赛Writeups</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MISC"><span class="toc-number">1.1.</span> <span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Mysterious-Picture"><span class="toc-number">1.1.1.</span> <span class="toc-text">Mysterious Picture</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hashing"><span class="toc-number">1.1.2.</span> <span class="toc-text">Hashing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Backdoor"><span class="toc-number">1.1.3.</span> <span class="toc-text">Backdoor</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">1.2.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Encrypted-Traffic"><span class="toc-number">1.2.1.</span> <span class="toc-text">Encrypted Traffic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Confidential"><span class="toc-number">1.2.2.</span> <span class="toc-text">Confidential</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse"><span class="toc-number">1.3.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ransomware"><span class="toc-number">1.3.1.</span> <span class="toc-text">Ransomware</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        金融业网络安全攻防大赛Writeups
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Jack Pan</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-08-09T14:03:25.000Z" itemprop="datePublished">2018-08-09</time>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/CTF/">CTF</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="金融业网络安全攻防大赛Writeups"><a href="#金融业网络安全攻防大赛Writeups" class="headerlink" title="金融业网络安全攻防大赛Writeups"></a>金融业网络安全攻防大赛Writeups</h1><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="Mysterious-Picture"><a href="#Mysterious-Picture" class="headerlink" title="Mysterious Picture"></a>Mysterious Picture</h3><p>在公司最近的一次项目中，关键数据疑似泄漏。经过某种手段已经把嫌疑锁定在嫌疑人A身上了，但是嫌疑人A的U盘中除了一张图片之外，没有发现任何相关的信息。你能帮助公司找到他泄漏数据的确凿证据吗？</p>
<p>题目给了一张图片，用StegSolve打开，每个通道都过一遍，发现rgb的最低位都有异常。</p>
<p>打开Analyse -&gt; Data Extract，选中最低位，直接Preview，没有flag。切换Bit Plane Order，切到BGR，发现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Do u know how the bad man send secret messages now? flag&#123;babylsbstego_cannot_be_easier!%^%^&amp;&#125;.</span><br></pre></td></tr></table></figure></p>
<h3 id="Hashing"><a href="#Hashing" class="headerlink" title="Hashing"></a>Hashing</h3><p>MD5($a) = d78b6f30225cdc811adfe8d4e7c9fd34<br>MD5($b) = 8fc42c6ddf9966db3b09e84365034357<br>MD5($c) = 5f295bce38d311f26a96eb811192f391</p>
<p>flag{$a_$b_$c}</p>
<p>直接在网上搜索得到：<br>$a = hack<br>$b = the<br>$c = planet<br>所以flag是：<code>flag{hack_the_planet}</code></p>
<h3 id="Backdoor"><a href="#Backdoor" class="headerlink" title="Backdoor"></a>Backdoor</h3><p>某银行安全团队在分析流量日志的过程中，发现了在 DMZ 区域的服务器被黑客入侵且放置了后门。运维部门提取出了流量中最可疑的部分，据有经验的安全专家分析，这里面应该包含了黑客上传的入侵证据文件，你能找到黑客入侵过程中出现了什么证据信息吗？</p>
<p>分析http流，把cmdcmdcmd参数base64解密，找到一段有用的：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@ini_set(<span class="string">"display_errors"</span>,<span class="string">"0"</span>);</span><br><span class="line">@set_time_limit(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(PHP_VERSION&lt;<span class="string">'5.3.0'</span>)&#123;</span><br><span class="line">  @set_magic_quotes_runtime(<span class="number">0</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"X@Y"</span>);</span><br><span class="line">$f=<span class="string">'C:\\phpStudy\\WWW\\uploads\\reverseshell.zip'</span>;</span><br><span class="line">$c=$_POST[<span class="string">"z1"</span>];</span><br><span class="line">$c=str_replace(<span class="string">"\r"</span>,<span class="string">""</span>,$c);</span><br><span class="line">$c=str_replace(<span class="string">"\n"</span>,<span class="string">""</span>,$c);</span><br><span class="line">$buf=<span class="string">""</span>;</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($c);$i+=<span class="number">2</span>)</span><br><span class="line">$buf.=urldecode(<span class="string">'%'</span>.substr($c,$i,<span class="number">2</span>));</span><br><span class="line"><span class="keyword">echo</span>(@fwrite(fopen($f,<span class="string">'w'</span>),$buf)?<span class="string">'1'</span>:<span class="string">'0'</span>);;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"X@Y"</span>);</span><br><span class="line"><span class="keyword">die</span>();</span><br></pre></td></tr></table></figure></p>
<p>代码意思就是z1参数写入文件，z1参数为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">504B0304140000000800288DC34C58BD2C542C0500002C0700000E000000313532383031383837352E706E676D956D54926718C7B12C4D33ED45CD94B034E9D4C9B6F2A5D4503B1A5A274CB1B2E341A798D35EA82D4D110173B9AD48C8B9B2A395A5A8684C84694D54B0B65646BA91C0A333C2487C8530ECE909151C7E4BE19CDFFD7CB8CF7D5FE77F5FD7F5BF9E2B47306807BB0D763018CC213A2A220E06B35A3FBF6C9798766CD59401186CF9547444787CEE6D8D3C96FE6ECFCA659D3DA95AAAEACD52F6CAA8412F955F03CA66DF43E550386C0BB652A15020EE0D570E2C2D10865DF7FC9241854A484155BEFD4E7D8B2DD1865E52B1EE1A67C488E3A6CFEF7C63B62B42C4ACB3397DA01016BE80826C3D69EC8E74A44B790E0B12E71834460DAAA09A94BDAE45A1F79AFDDA2BFCB26778C1177486EB49F582C84709FFB2013AF4A019744C64DF105E28FB081AF702D4CBA1E9DE3F3B79DB7E09EBA65031C67AF19A8B20F2BCE512728D406AC8C3517E715BB1C47A21C6747D5B3D1485436BB5D1C06903E7A499DA79C1E341AFC01BC5CAEDB0987297FC727AAD667D58EFF8B16755BD20E22DC36DC5E6454157BD5050B31FE5A3F1F0A5B9D3EFAA00A36D779493E74226897FF6F45FED7210A3CBE4817B0BE8FBE4871D6684347385C3E5A3819A0139878BD9F8208F999071F7B593A187E4FF5B98074E76CDDAAA7021525D4E07A18F3B95A363F54EB400B58EC1C422EECD51508422EF4C5F982413197BA7752C425FEC34BB8C490BE671722288711E09860A78A286E5D8F9FEDC2D1F33DD5F411B220D4C71570F6A06CA1BD9EE5E7A07AC40A9D35CEF07ED5E636DBB90663F71657E7155639F7A384FC4F42AC54D069F5295C624BA6E5A1CB8C9971AE3125D7635F1090D08E19F3124C1C7491A48EA1A40F74D6C2FF1DD3F99B4E89D366D42DA3E35C38E078FD4545BA919E379C9FA6AA516ECF8548AB868A1CE28B87424AF98572F49F2E864A6DECFFF1E82C4EB7D84FD7452266549B1B5D979192776DD71F7719A33DCDEFE703781DE782299B3B5BC1D48739C9978699694264AB17270CEF1624D6B92CF1BE83F253864BF0BDF62ACF599469B1F3E7FFE4735B8DCEFA9306403157BA18AFC1439F93105098181E00411699E448FDB9B667A367E02D02DD426B5D879DCA083E63EB7D975CF01F1BF86A69A9BEB876164A9212CE8FDD1D0632D99100496E7F6B636E283479103C21093B70A16798B3F2B8FDDDCFE2660DAC1F92DD74AE20FBA55CEA623735A2A4A3C17B97DDEF046371EBCAE3CA0E30057D21C72D44FFFEAA0BC2F351D61AE3ABE6274A7545452BA654C799271F01160DF7D088E76F1C0A5E8EA6A684EED65161C9E193C0556631427EA1A2BCE5C6E8E6F3F4EE690D79A47668B14A5D211BA08F3FE3961DBF300693D64D344E500379990146DEEDEF959C3F636A4093F0F64C94E61C1563C2E8527D60FA13E18ACDA2F99F78989866F9F63F8145606F931132F9DB853DD909CA2CB559263A05D96B28763BB07C03FF66749329F3D7000FF0E021847C99A354F045D96065FABEF7EB420437BA14322E08C71F3C54087242BE4C96A8B4527E13ECCF6D69276F867CB76DEDD7104D1C9CCA18F5F31572C53696BBA5EE0B94654FF2CD334CAB01F72E61ECB62C49A3D9C8794223A72127FA0D076718FE8A038ACB66415B8ED6CEF4F9A0CA1E96A1A6FAB826974BE65A9ECF7F8F42C1C79D9601B5F7AA63C24E153C62582EEA552E9BED642774F822A2DF9305985FCE7FAD96DD181FE32E28868F521708B93851E1129929B0FF1EBB93D436BFFA05C256011350691E021BEC4FC91A6890A044EB9F86B8C465FB8CD3046F697A215303EBB66BD7AD15CA80C3DF2AAC88243E7952176AF6B886B2408969BFE82B0E8484C44E3FE6F0AFF07504B01021400140000000800288DC34C58BD2C542C0500002C0700000E0000000000000000002000000000000000313532383031383837352E706E67504B050600000000010001003C000000580500000000</span><br></pre></td></tr></table></figure></p>
<p>得到zip文件，解压后是一张二维码：</p>
<p>扫描二维码，得到flag：<code>flag{b3c4r3fortheChinaChopperFHGJKUI^U%}</code>。</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Encrypted-Traffic"><a href="#Encrypted-Traffic" class="headerlink" title="Encrypted Traffic"></a>Encrypted Traffic</h3><p>某银行客户端以安全著称，所有网络流量都开启了密码学防护机制。有一天，你抓到了局域网中的网银登录流量。在这个流量中，密码字段的值为 ac22543d5382cbf48b6ebcf6e40f123d9ca4b91f9998e4c2f2422402。根据分析，你获得了如下的线索：<br>1.上面抓到的登录流量密码字段是 SHA 系列哈希算法的哈希值。<br>2.这个登录密码也是银行卡的 ATM 取款密码。<br>3.登录密码的哈希值是加盐之后计算的结果，根据逆向分析，盐的值是用户名的拼音，而你推测出了流量来自于邻居 “张三丰”</p>
<p>有了这些线索之后，你能够分析出密码是什么吗？</p>
<p>flag 提交格式： flag{密码<em>哈希算法</em>盐}<br>举例： flag{123456_SHA999_lisi}</p>
<p>拿到hash之后，直接上hash-identifier，识别出是：SHA224。<br>密码是六位数字，直接爆破：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">target = <span class="string">'ac22543d5382cbf48b6ebcf6e40f123d9ca4b91f9998e4c2f2422402'</span></span><br><span class="line">salt = <span class="string">'zhangsanfeng'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">            <span class="keyword">for</span> l <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">                <span class="keyword">for</span> m <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">                    <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">                        password = str(i) + str(j) + str(k) + str(l) + str(m) + str(n)</span><br><span class="line">                        h = hashlib.sha224(password + salt).hexdigest()</span><br><span class="line">                        <span class="keyword">if</span> h == target:</span><br><span class="line">                            <span class="keyword">print</span> password</span><br><span class="line">                            exit()</span><br></pre></td></tr></table></figure></p>
<p>得到密码：877295，拼成flag：<code>flag{877295_SHA224_zhangsanfeng}</code>。</p>
<h3 id="Confidential"><a href="#Confidential" class="headerlink" title="Confidential"></a>Confidential</h3><p>某银行的机密资料文件加密存储在一个电脑中，密钥存储在另外一个电脑中。可是有一天发生了意外，存储密钥的电脑硬盘损坏了。然而没有这个机密资料银行就无法开展业务，于是派出了安全专家来尝试解密资料。好在机密资料使用的加密算法并不复杂，你能帮他解开机密资料吗？已知：<br>这个机密资料与跨行转帐有关，根据日常维护该机密资料的运维小红回忆，该机密资料的最后几行内容是：<br>Please make sure keep this secret safe.<br>Please make sure keep this secret safe.<br>Please make sure keep this secret safe.</p>
<p>查看源码可以知道加密过程为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cipher_block1 = plain_block1 ^ IV ^ Key</span><br><span class="line">cipher_block2 = plain_block2 ^ cipher_block1 ^ Key</span><br><span class="line">cipher_block3 = plain_block3 ^ cipher_block2 ^ Key</span><br><span class="line">cipher_block4 = plain_block4 ^ cipher_block3 ^ Key</span><br><span class="line">…</span><br></pre></td></tr></table></figure></p>
<p>用最后三块密文和最后两块明文，通过枚举最后一块的padding，可以计算出两个Key来，当两个Key相等时，Key就找到了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[127, 84, 183, 104, 20, 239, 255, 134, 158, 177, 142, 38, 36, 137, 8, 162]</span><br></pre></td></tr></table></figure></p>
<p>利用Key和密文就可以恢复出明文来：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cret for our bank account.</span><br><span class="line"></span><br><span class="line">A SWIFT code is an international bank code that identifies particular banks worldwide.</span><br><span class="line">It&apos;s also known as a Bank Identifier Code (BIC).</span><br><span class="line">CommBank uses SWIFT codes to send money to overseas banks.</span><br><span class="line">A SWIFT code consists of 8 or 11 characters.</span><br><span class="line"></span><br><span class="line">Our Bank swift code is flag&#123;CTBJCN2B&#125;.</span><br><span class="line"></span><br><span class="line">Please make sure keep this secret safe.</span><br><span class="line">Please make sure keep this secret safe.</span><br><span class="line">Please make sure keep this secret safe.</span><br></pre></td></tr></table></figure></p>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="Ransomware"><a href="#Ransomware" class="headerlink" title="Ransomware"></a>Ransomware</h3><p>公司财务人员的电脑中了勒索软件，财务报表被加密了，必须向攻击者支付比特币才能获得解密密码。作为安全人员，你有办法分析出解密密码吗？</p>
<p>IDA逆向，F5，得到关键函数<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">signed</span> <span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_401010</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [esp+0h] [ebp-4h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> j; <span class="comment">// [esp+0h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">18</span>; ++i )</span><br><span class="line">    *(_BYTE *)(i + a1) ^= <span class="number">0xCC</span>u;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">18</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *(<span class="keyword">char</span> *)(j + a1) != byte_404000[j] )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>逻辑就是得到的密码与<code>0xcc</code>异或，判断结果是否为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FD 93 A8 83 93 A2 FC B8 93 BB 8D A2 A2 AD 93 AF BE B5</span><br></pre></td></tr></table></figure></p>
<p>把结果和<code>0xcc</code>异或就得到密码了：<code>flag{1_dO_n0t_wAnna_cry}</code></p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>加载评论需要在浏览器启用 JavaScript 脚本支持。</noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/jack0pan">项目</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#金融业网络安全攻防大赛Writeups"><span class="toc-number">1.</span> <span class="toc-text">金融业网络安全攻防大赛Writeups</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MISC"><span class="toc-number">1.1.</span> <span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Mysterious-Picture"><span class="toc-number">1.1.1.</span> <span class="toc-text">Mysterious Picture</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hashing"><span class="toc-number">1.1.2.</span> <span class="toc-text">Hashing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Backdoor"><span class="toc-number">1.1.3.</span> <span class="toc-text">Backdoor</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">1.2.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Encrypted-Traffic"><span class="toc-number">1.2.1.</span> <span class="toc-text">Encrypted Traffic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Confidential"><span class="toc-number">1.2.2.</span> <span class="toc-text">Confidential</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse"><span class="toc-number">1.3.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ransomware"><span class="toc-number">1.3.1.</span> <span class="toc-text">Ransomware</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/&text=金融业网络安全攻防大赛Writeups"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/&title=金融业网络安全攻防大赛Writeups"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/&is_video=false&description=金融业网络安全攻防大赛Writeups"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=金融业网络安全攻防大赛Writeups&body=Check out this article: http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/&title=金融业网络安全攻防大赛Writeups"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/&title=金融业网络安全攻防大赛Writeups"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/&title=金融业网络安全攻防大赛Writeups"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/&title=金融业网络安全攻防大赛Writeups"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://jack0pan.github.io/2018/08/09/金融业网络安全攻防大赛Writeups/&name=金融业网络安全攻防大赛Writeups&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 Jack Pan
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/jack0pan">项目</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'jack0pan';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


