<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="#Net
##Net 0AboutThis level takes a look at converting strings to little endian integers.
This level is at /opt/protostar/bin/net0">
    

    <!--Author-->
    
        <meta name="author" content="junzhepan">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Exploit Exercises Protostar Net Write-ups"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="junzhepan"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>Exploit Exercises Protostar Net Write-ups - junzhepan</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css" type="text/css">

    <!-- Google Analytics -->
    


    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/favicons/manifest.json">
    <link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#fff">
    <meta name="apple-mobile-web-app-title" content="Jack Pan">
    <meta name="application-name" content="Jack Pan">
    <meta name="theme-color" content="#ffffff”>

</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    首页
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    归档
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/atom.xml">
                    订阅
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>


<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-code" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2014/10/11/Exploit-Exercises-Protostar-Net-Write-ups/">
                Exploit Exercises Protostar Net Write-ups
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2014-10-11</span>
            
            <a href="#disqus_thread" class="comments">评论</a>
            
                <span class="category">
                    <a href="/categories/Exploit/">Exploit</a>
                </span>
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <p>#Net</p>
<p>##Net 0<br>About<br>This level takes a look at converting strings to little endian integers.</p>
<p>This level is at /opt/protostar/bin/net0</p>
<a id="more"></a>
<p>Source code</p>
<pre><code>#include &quot;../common/common.c&quot;

#define NAME &quot;net0&quot;
#define UID 999
#define GID 999
#define PORT 2999

void run()
{
 unsigned int i;
 unsigned int wanted;

 wanted = random();

 printf(&quot;Please send &apos;%d&apos; as a little endian 32bit int\n&quot;, wanted);

 if(fread(&amp;i, sizeof(i), 1, stdin) == NULL) {
  errx(1, &quot;:(\n&quot;);
 }

 if(i == wanted) {
  printf(&quot;Thank you sir/madam\n&quot;);
 } else {
  printf(&quot;I&apos;m sorry, you sent %d instead\n&quot;, i);
 }
}

int main(int argc, char **argv, char **envp)
{
 int fd;
 char *username;

 /* Run the process as a daemon */
 background_process(NAME, UID, GID);

 /* Wait for socket activity and return */
 fd = serve_forever(PORT);

 /* Set the client socket to STDIN, STDOUT, and STDERR */
 set_io(fd);

 /* Don&apos;t do this :&gt; */
 srandom(time(NULL));

 run();
}
</code></pre><p>先用nc去连接，看一下：</p>
<pre><code>$ nc localhost 2999
Please send &apos;2081363632&apos; as a little endian 32bit int
2081363632
I&apos;m sorry, you sent 825765938 instead
</code></pre><p>既然需要小端的顺序，用Python实现：</p>
<pre><code>import socket
from struct import pack
from binascii import hexlify


RHOST = &apos;192.168.126.129&apos;
RPORT = 2999

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((RHOST, RPORT))

data = s.recv(1024)
print &quot;%s&quot; % data

value = int((data.split()[2])[1:-1])

print &quot;Big Endian: 0x%x&quot; % value
value = pack(&quot;&lt;I&quot;, value) # little endian

print &quot;Little Endian: 0x%s&quot; % hexlify(value)
s.sendall(value) # send the value back

data = s.recv(1024)
print &quot;%s&quot; % data # print the confirmation

s.close()
</code></pre><p>结果如下：</p>
<pre><code>Please send &apos;1104733458&apos; as a little endian 32bit int

Big Endian: 0x41d8e512
Little Endian: 0x12e5d841
Thank you sir/madam
</code></pre><p>##Net 1<br>About<br>This level introduces the concept that memory can be accessed outside of its allocated region, how the stack variables are laid out, and that modifying outside of the allocated memory can modify program execution.</p>
<p>This level is at /opt/protostar/bin/net1</p>
<p>Source code</p>
<pre><code>#include &quot;../common/common.c&quot;

#define NAME &quot;net1&quot;
#define UID 998
#define GID 998
#define PORT 2998

void run()
{
 char buf[12];
 char fub[12];
 char *q;

 unsigned int wanted;

 wanted = random();

 sprintf(fub, &quot;%d&quot;, wanted);

 if(write(0, &amp;wanted, sizeof(wanted)) != sizeof(wanted)) {
  errx(1, &quot;:(\n&quot;);
 }

 if(fgets(buf, sizeof(buf)-1, stdin) == NULL) {
  errx(1, &quot;:(\n&quot;);
 }

 q = strchr(buf, &apos;\r&apos;); if(q) *q = 0;
 q = strchr(buf, &apos;\n&apos;); if(q) *q = 0;

 if(strcmp(fub, buf) == 0) {
  printf(&quot;you correctly sent the data\n&quot;);
 } else {
  printf(&quot;you didn&apos;t send the data properly\n&quot;);
 }
}

int main(int argc, char **argv, char **envp)
{
 int fd;
 char *username;

 /* Run the process as a daemon */
 background_process(NAME, UID, GID);

 /* Wait for socket activity and return */
 fd = serve_forever(PORT);

 /* Set the client socket to STDIN, STDOUT, and STDERR */
 set_io(fd);

 /* Don&apos;t do this :&gt; */
 srandom(time(NULL));

 run();
}
</code></pre><p>连上，看看让干啥：</p>
<pre><code>$ nc localhost 2998
▒Ͷ
ssss
you didn&apos;t send the data properly
</code></pre><p>用Python实现：</p>
<pre><code>import socket
import struct

RHOST = &apos;192.168.126.129&apos;
RPORT = 2998

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((RHOST, RPORT))

data = s.recv(1024)
print &quot;Receive data: %s&quot; % data

value = struct.unpack(&quot;i&quot;, data)

s.sendall(&quot;%s\r\n&quot; % value) # send the value back

data = s.recv(1024)
print &quot;%s&quot; % data # print the confirmation

s.close()
</code></pre><p>结果如下：</p>
<pre><code>Receive data: C�@
you correctly sent the data
</code></pre><p>##Net 2<br>About<br>This level introduces the concept that memory can be accessed outside of its allocated region, how the stack variables are laid out, and that modifying outside of the allocated memory can modify program execution.</p>
<p>This level is at /opt/protostar/bin/net2</p>
<p>Source code</p>
<pre><code>#include &quot;../common/common.c&quot;

#define NAME &quot;net2&quot;
#define UID 997
#define GID 997
#define PORT 2997

void run()
{
 unsigned int quad[4];
 int i;
 unsigned int result, wanted;

 result = 0;
 for(i = 0; i &lt; 4; i++) {
  quad[i] = random();
  result += quad[i];

  if(write(0, &amp;(quad[i]), sizeof(result)) != sizeof(result)) {
   errx(1, &quot;:(\n&quot;);
  }
 }

 if(read(0, &amp;wanted, sizeof(result)) != sizeof(result)) {
  errx(1, &quot;:&lt;\n&quot;);
 }


 if(result == wanted) {
  printf(&quot;you added them correctly\n&quot;);
 } else {
  printf(&quot;sorry, try again. invalid\n&quot;);
 }
}

int main(int argc, char **argv, char **envp)
{
 int fd;
 char *username;

 /* Run the process as a daemon */
 background_process(NAME, UID, GID);

 /* Wait for socket activity and return */
 fd = serve_forever(PORT);

 /* Set the client socket to STDIN, STDOUT, and STDERR */
 set_io(fd);

 /* Don&apos;t do this :&gt; */
 srandom(time(NULL));

 run();
}
</code></pre><p>连接，查看：</p>
<pre><code>$ nc localhost 2997
M▒▒jn(q]▒
45678
sorry, try again. invalid
</code></pre><p>Python实现：</p>
<pre><code>import socket
import struct

RHOST = &apos;192.168.126.129&apos;
RPORT = 2997

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((RHOST, RPORT))

wanted = 0
for i in xrange(4):
data = s.recv(4)
value = struct.unpack(&quot;i&quot;, data)[0]
print &quot;Receive value: %d&quot; % value
wanted += value

wanted &amp;= 0xffffffff
print &quot;Sum: %d&quot; % wanted

wanted = struct.pack(&quot;i&quot;, wanted)
s.sendall(wanted)

data = s.recv(1024)
print &quot;%s&quot; % data # print the confirmation

s.close()
</code></pre><p>结果：</p>
<pre><code>Receive value: 1336412356
Receive value: 1995755184
Receive value: 1089074857
Receive value: 1737542227
Sum: 1863817328
you added them correctly
</code></pre><p>##Net 3<br>About<br>This level introduces the concept that memory can be accessed outside of its allocated region, how the stack variables are laid out, and that modifying outside of the allocated memory can modify program execution.</p>
<p>This level is at /opt/protostar/bin/net3</p>
<p>Source code</p>
<pre><code>#include &quot;../common/common.c&quot;

#define NAME &quot;net3&quot;
#define UID 996
#define GID 996
#define PORT 2996

/*
 * Extract a null terminated string from the buffer
 */

int get_string(char **result, unsigned char *buffer, u_int16_t len)
{
 unsigned char byte;

 byte = *buffer;

 if(byte &gt; len) errx(1, &quot;badly formed packet&quot;);
 *result = malloc(byte);
 strcpy(*result, buffer + 1);

 return byte + 1;
}

/*
 * Check to see if we can log into the host
 */

int login(unsigned char *buffer, u_int16_t len)
{
 char *resource, *username, *password;
 int deduct;
 int success;

 if(len &lt; 3) errx(1, &quot;invalid login packet length&quot;);

 resource = username = password = NULL;

 deduct = get_string(&amp;resource, buffer, len);
 deduct += get_string(&amp;username, buffer+deduct, len-deduct);
 deduct += get_string(&amp;password, buffer+deduct, len-deduct);

 success = 0;
 success |= strcmp(resource, &quot;net3&quot;);
 success |= strcmp(username, &quot;awesomesauce&quot;);
 success |= strcmp(password, &quot;password&quot;);

 free(resource);
 free(username);
 free(password);

 return ! success;
}

void send_string(int fd, unsigned char byte, char *string)
{
 struct iovec v[3];
 u_int16_t len;
 int expected;

 len = ntohs(1 + strlen(string));

 v[0].iov_base = &amp;len;
 v[0].iov_len = sizeof(len);

 v[1].iov_base = &amp;byte;
 v[1].iov_len = 1;

 v[2].iov_base = string;
 v[2].iov_len = strlen(string);

 expected = sizeof(len) + 1 + strlen(string);

 if(writev(fd, v, 3) != expected) errx(1, &quot;failed to write correct amount of bytes&quot;);

}

void run(int fd)
{
 u_int16_t len;
 unsigned char *buffer;
 int loggedin;

 while(1) {
  nread(fd, &amp;len, sizeof(len));
  len = ntohs(len);
  buffer = malloc(len);

  if(! buffer) errx(1, &quot;malloc failure for %d bytes&quot;, len);

  nread(fd, buffer, len);

  switch(buffer[0]) {
   case 23:
    loggedin = login(buffer + 1, len - 1);
    send_string(fd, 33, loggedin ? &quot;successful&quot; : &quot;failed&quot;);
    break;

   default:
    send_string(fd, 58, &quot;what you talkin about willis?&quot;);
    break;
  }
 }
}

int main(int argc, char **argv, char **envp)
{
 int fd;
 char *username;

 /* Run the process as a daemon */
 background_process(NAME, UID, GID);

 /* Wait for socket activity and return */
 fd = serve_forever(PORT);

 /* Set the client socket to STDIN, STDOUT, and STDERR */
 set_io(fd);

 /* Don&apos;t do this :&gt; */
 srandom(time(NULL));

 run(fd);
}
</code></pre><p>直接上Python：</p>
<pre><code>import socket
from struct import pack
from binascii import hexlify

RHOST = &apos;192.168.126.129&apos;
RPORT = 2996
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((RHOST, RPORT))

resource = &quot;net3&quot;
resource = pack(&quot;B&quot;, len(resource)+1) + resource + &quot;\x00&quot;

user = &quot;awesomesauce&quot;
user = pack(&quot;B&quot;, len(user)+1) + user + &quot;\x00&quot;

password = &quot;password&quot;
password = pack(&quot;B&quot;, len(password)+1) + password + &quot;\x00&quot;

auth = &quot;\x17&quot; + resource + user + password
auth_len = pack(&quot;&gt;H&quot;, len(auth))

packet = auth_len + auth
print &quot;Send data: %s&quot; % hexlify(packet)

s.sendall(packet)

data = s.recv(1024)
print &quot;%s&quot; % data

s.close()
</code></pre><p>结果：</p>
<pre><code>Send data: 001f17056e657433000d617765736f6d657361756365000970617373776f726400
!successful
</code></pre>
    </div>

    

    
        <div class="post-tags">
            <i class="fa fa-tags" aria-hidden="true"></i>
            <a href="/tags/Exercise/">#Exercise</a> <a href="/tags/Exploit/">#Exploit</a>
        </div>
    

    <!-- Comments -->
    
    <div class="comments">
        
<div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>



    </div>
    

</div>
        </section>

    </div>
</div>

</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>关于</h2>
                <p>
                    本人，脾气好，不喷人，操作虎，意识强，渗透快，shell多，能过狗。同时，我也是<a href='https://www.watch0ut.com'>watch0ut</a>的一员。
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>最近博客</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2016/11/13/技术分析之黑客军团第二季/">技术分析之黑客军团第二季</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016/10/30/技术分析之黑客军团第一季/">技术分析之黑客军团第一季</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016/09/22/数字证书-Ruby/">数字证书-Ruby</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016/08/17/密码算法-Ruby/">密码算法-Ruby</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>分类</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/OpenWrt/">OpenWrt</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/Other/">Other</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/Android/">Android</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/Tool/">Tool</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/junzhepan">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://twitter.com/junzhepan">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.facebook.com/jack.pan.965">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="https://plus.google.com/100259285096579239148">
                            <span class="footer-icon-container">
                                <i class="fa fa-google-plus"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:jack@watch0ut.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="atom.xml">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @junzhepan. All right reserved | Powerd by Hexo & <a href='https://github.com/klugjo'>Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js" type="text/javascript"></script>

<!-- Disqus Comments -->

<script type="text/javascript">
    var disqus_shortname = 'junzhepan';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>

</html>